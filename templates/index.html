<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>To My Wifey âœ¨</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <audio id="bgMusic" loop>
    <source src="/music/bg.mp3" type="audio/mpeg">
  </audio>

  <div class="unlock-screen" id="unlockScreen">
    <div class="unlock-box">
      <h2>Enter the day our story began ðŸ’•</h2>
      <input type="text" id="unlockInput" placeholder="DD OCT">
      <button onclick="checkUnlock()">Unlock</button>
      <p id="unlockMsg"></p>
    </div>
  </div>

  <canvas id="fireworksCanvas"></canvas>

  <div class="container" id="mainApp" style="display:none;">
    <h1>Happy Girlfriend Day Wifey ðŸ’•</h1>
    <div id="timer">We've been together for: <span id="timeCount"></span></div>

    <div class="image-box">
      <img id="slideshow" src="{{ url_for('static', filename='images/' + images[0]) }}" alt="her-pic">
    </div>

    <div class="paragraph-box">
      <p id="romanticText">{{ lines[0] }}</p>
    </div>
  </div>

  <script>
    const images = {{ images|tojson }};
    const paragraphs = {{ lines|tojson }};
    let imgIndex = 0;
    let paraIndex = 0;
    const imgTag = document.getElementById("slideshow");
    const textTag = document.getElementById("romanticText");

    setInterval(() => {
      imgIndex = (imgIndex + 1) % images.length;
      imgTag.src = `/static/images/${images[imgIndex]}`;
      // ROTATE specific image (if it's sideways)
      imgTag.className = images[imgIndex].includes("IMG-20250714") ? "rotate" : "";
    }, 5000);

    setInterval(() => {
      paraIndex = (paraIndex + 1) % paragraphs.length;
      textTag.innerHTML = paragraphs[paraIndex];
    }, 8000);

    const start = new Date("2025-03-10T20:46:07");
    const counter = document.getElementById("timeCount");
    function updateTimer() {
      const now = new Date();
      let diff = now - start;
      let days = Math.floor(diff / (1000 * 60 * 60 * 24));
      let hrs = Math.floor((diff / (1000 * 60 * 60)) % 24);
      let mins = Math.floor((diff / (1000 * 60)) % 60);
      counter.innerText = `${days} days, ${hrs} hrs, ${mins} min ðŸ’ž`;
    }
    setInterval(updateTimer, 60000);
    updateTimer();

    // UNLOCK SCREEN
    function checkUnlock() {
      const val = document.getElementById("unlockInput").value.trim().toLowerCase();
      const valid = ["22 oct", "22/10", "22-10"];
      if (valid.includes(val)) {
        document.getElementById("unlockScreen").style.display = "none";
        document.getElementById("mainApp").style.display = "block";
        playMusic();
        triggerFireworks();
      } else {
        document.getElementById("unlockMsg").innerText = "That's not the day we met... try again ðŸ˜”";
      }
    }

    // FIREWORKS (only if date is 1 Aug or later)
    function triggerFireworks() {
      const today = new Date();
      const canvas = document.getElementById("fireworksCanvas");
      if (today.getMonth() === 7 && today.getDate() >= 1) {
        canvas.style.display = "block";
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const hearts = [];
        for (let i = 0; i < 100; i++) {
          hearts.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            size: Math.random() * 10 + 4,
            speed: Math.random() * 1 + 0.5,
            color: `hsl(${Math.random() * 360}, 70%, 60%)`
          });
        }
        function animate() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          hearts.forEach(h => {
            ctx.beginPath();
            ctx.fillStyle = h.color;
            ctx.arc(h.x, h.y, h.size, 0, Math.PI * 2);
            ctx.fill();
            h.y -= h.speed;
            if (h.y < 0) h.y = canvas.height;
          });
          requestAnimationFrame(animate);
        }
        animate();
      }
    }

    function playMusic() {
      const music = document.getElementById("bgMusic");
      music.play().catch(() => {
        const clickToStart = document.createElement("button");
        clickToStart.innerText = "Click to Play Music";
        clickToStart.style.padding = "12px 24px";
        clickToStart.style.marginTop = "20px";
        clickToStart.style.fontSize = "1rem";
        document.body.appendChild(clickToStart);
        clickToStart.onclick = () => {
          music.play();
          clickToStart.remove();
        };
      });
    }
  </script>
</body>
</html>